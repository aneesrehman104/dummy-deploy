import React, { useEffect, useState } from "react";

import styles from "../ipos.module.css";
import dynamic from "next/dynamic";
import Image from "next/image";
import Skeleton from "@mui/material/Skeleton";
import AddCircleIcon from "@mui/icons-material/AddCircle";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import { useMemberstackModal } from "@memberstack/react";
import { useContext } from "react";
import { MemberInformationContext } from "@/lib/components/context";
import { Checkbox, FormControlLabel, Menu, MenuItem } from "@mui/material";
import { getApiWithoutAuth, getODataWithParams } from "@lib/ts/api";
import { URLs } from "@/lib/ts/apiUrl";
import { GraphDataInterface } from "@/lib/ts/interface";
import { initialGraphData } from "@/lib/ts/initialState";
import axios, { AxiosError } from "axios";

const jsonResponse = "application/json";
interface PROPS {}

const DynamicChart = dynamic(() => import("../ipo-chart.component"), {
  ssr: false,
  loading: () => <Skeleton variant="rounded" height={200} />,
});
interface PROPS {}

const dataSet = [
  {
    name: "Data",
    value: "March 13, 1986",
  },
  {
    name: "Proceeds",
    value: "XXX",
  },
  {
    name: "Previous FY Revenue ",
    value: "$100M",
  },
  {
    name: "Type",
    value: "XXX",
  },
  {
    name: "Underwriters",
    value: "SoftBank",
  },
  {
    name: "S-1 Prospectus",
    value: "Icon",
  },
  {
    name: "Return",
    value: "327,401",
  },
  {
    name: "Shared Offers",
    value: "XXX",
  },
  {
    name: "Annualised Return",
    value: "XX% YTD",
  },
  {
    name: "CEO",
    value: "Bill Gates",
  },
];

const IposCompany: React.FC<PROPS> = () => {
  const [isLoading, setIsLoading] = useState<boolean>(true);
  const [graphData, setGraphData] =
    useState<GraphDataInterface<any>>(initialGraphData);
  const { openModal, hideModal } = useMemberstackModal();
  const { user } = useContext(MemberInformationContext);

  const options = {
    chartOptions: {
      chart: {
        height: null,
        width: null,
        marginTop: 10,
        marginBottom: 70,
        zoomType: "x",
        plotBackgroundColor: null,
        renderTo: "container",
        animation: false,
        zooming: {
          mouseWheel: {
            enabled: false,
          },
        },
      },
      accessibility: {
        enabled: false,
      },
      rangeSelector: {
        buttons: [
          {
            type: "day",
            count: 1,
            text: "1 D",
          },
          {
            type: "month",
            count: 1,
            text: "1 M",
          },
          {
            type: "month",
            count: 3,
            text: "3 M",
          },
          {
            type: "year",
            count: 1,
            text: "1 Y",
          },
          {
            type: "year",
            count: 5,
            text: "5 Y",
          },
          {
            type: "all",
            text: "All",
          },
        ],
        selected: 3,
        zoomText: "",
        enabled: true,
        inputEnabled: false,
      },
      navigator: {
        enabled: false,
        margin: 20,
      },
      scrollbar: {
        enabled: false,
      },

      legend: {
        enabled: false,
        itemStyle: {
          lineHeight: '5px', // Adjust the line height to change the box height
        },
      },
      tooltip: {
        shared: true,
        split: false,
        style: {
          fontSize: "12px",
        },
        series: {
          pointStart: 1279324800000,
          pointInterval: 24 * 3600 * 1000,
        },
      },
      xAxis: {
        type: "datetime",
        gridLineWidth: 1,
      },
      yAxis: [
        {
          lineColor: "white",
          lineWidth: 1,
          offset: 30,
          gridLineWidth: 1,
        },
        
      ],
      data: {
        decimalPoint: ".",
        thousandsSep: ",",
      },
      plotOptions: {
        series: {
          showInLegend: true,
          dataGrouping: {
            enabled: false,
          },
          lineWidth: 2,
          fillColor: { // Add this fillColor configuration
            linearGradient: [0, 0, 0, 300],
            stops: [
              [0, 'rgba(0, 0, 255, 0.1)'], // Start color
              [1, 'white'],   // End color (transparent)
            ],
          },
        },
      },
      credits: {
        enabled: false,
      },
      series: [
        {
          type: "area",
          yAxis: 0,
          data: [
            [1587648600000, 68.97],
            [1587735000000, 69.3, 70.75, 69.25, 70.74, 126161200],
            [1587994200000, 70.45, 71.14, 69.99, 70.79, 117087600],
            [1588167000000, 71.18, 72.42, 70.97, 71.93, 137280800],
            [1588253400000, 72.49, 73.63, 72.09, 73.45, 183064000],
        
            [1588685400000, 73.76, 75.25, 73.61, 74.39, 147751200],
            [1588771800000, 75.11, 75.81, 74.72, 75.16, 142333600],
            [1588858200000, 75.81, 76.29, 75.49, 75.93, 115215200],
            [1588944600000, 76.41, 77.59, 76.07, 77.53, 133838400],
            [1589203800000, 77.03, 79.26, 76.81, 78.75, 145946400],
            [1589290200000, 79.46, 79.92, 77.73, 77.85, 162301200],
            [1589376600000, 78.04, 78.99, 75.8, 76.91, 200622400],
            [1589463000000, 76.13, 77.45, 75.38, 77.39, 158929200],
            [1589549400000, 75.09, 76.97, 75.05, 76.93, 166348400],
            [1589808600000, 78.29, 79.13, 77.58, 78.74, 135178400],
            [1589895000000, 78.76, 79.63, 78.25, 78.29, 101729600],
   
            [1591018200000, 79.44, 80.59, 79.3, 80.46, 80791200],
            [1591104600000, 80.19, 80.86, 79.73, 80.83, 87642800],
            [1591191000000, 81.17, 81.55, 80.57, 81.28, 104491200],
            [1591277400000, 81.1, 81.4, 80.19, 80.58, 87560400],
            [1591363800000, 80.84, 82.94, 80.81, 82.88, 137250400],
            [1591623000000, 82.56, 83.4, 81.83, 83.36, 95654400],
            [1591709400000, 83.04, 86.4, 83, 86, 147712400],
            [1591795800000, 86.97, 88.69, 86.52, 88.21, 166651600],
            [1591882200000, 87.33, 87.76, 83.87, 83.97, 201662400],
          
            [1592919000000, 91, 93.1, 90.57, 91.63, 212155600],
            [1593005400000, 91.25, 92.2, 89.63, 90.01, 192623200],
            [1593091800000, 90.18, 91.25, 89.39, 91.21, 137522400],
            [1593178200000, 91.1, 91.33, 88.25, 88.41, 205256800],
            [1593437400000, 88.31, 90.54, 87.82, 90.44, 130646000],
            [1593523800000, 90.02, 91.5, 90, 91.2, 140223200],
            [1593610200000, 91.28, 91.84, 90.98, 91.03, 110737200],
            [1593696600000, 91.96, 92.62, 90.91, 91.03, 114041600],
            [1594042200000, 92.5, 93.94, 92.47, 93.46, 118655600],
            [1594128600000, 93.85, 94.65, 93.06, 93.17, 112424400],
            [1594215000000, 94.18, 95.38, 94.09, 95.34, 117092000],
            [1594301400000, 96.26, 96.32, 94.67, 95.75, 125642800],
       
            [1595338200000, 99.17, 99.25, 96.74, 97, 103433200],
            [1595424600000, 96.69, 97.97, 96.6, 97.27, 89001600],
            [1595511000000, 97, 97.08, 92.01, 92.85, 197004400],
            [1595597400000, 90.99, 92.97, 89.14, 92.61, 185438800],
            [1595856600000, 93.71, 94.9, 93.48, 94.81, 121214000],
            [1595943000000, 94.37, 94.55, 93.25, 93.25, 103625600],
            [1596029400000, 93.75, 95.23, 93.71, 95.04, 90329200],
            [1596115800000, 94.19, 96.3, 93.77, 96.19, 158130000],
            [1596202200000, 102.89, 106.42, 100.82, 106.26, 374336800],
            [1596461400000, 108.2, 111.64, 107.89, 108.94, 308151200],
           
            [1597066200000, 112.6, 113.78, 110, 112.73, 212403600],
            [1597152600000, 111.97, 112.48, 109.11, 109.38, 187902400],
            [1597239000000, 110.5, 113.28, 110.3, 113.01, 165598000],
            [1597325400000, 114.43, 116.04, 113.93, 115.01, 210082000],
            [1597411800000, 114.83, 115, 113.04, 114.91, 165565200],
            [1597671000000, 116.06, 116.09, 113.96, 114.61, 119561600],
            [1597757400000, 114.35, 116, 114.01, 115.56, 105633600],
  
            [1598967000000, 132.76, 134.8, 130.53, 134.18, 151948100],
            [1599053400000, 137.59, 137.98, 127, 131.4, 200119000],
            [1599139800000, 126.91, 128.84, 120.5, 120.88, 257599600],
            [1599226200000, 120.07, 123.7, 110.89, 120.96, 332607200],
            [1599571800000, 113.95, 118.99, 112.68, 112.82, 231366600],
            [1599658200000, 117.26, 119.14, 115.26, 117.32, 176940500],
            [1599744600000, 120.36, 120.5, 112.5, 113.49, 182274400],
            [1599831000000, 114.57, 115.23, 110, 112, 180860300],
          
            [1600349400000, 109.72, 112.2, 108.71, 110.34, 178011000],
            [1600435800000, 110.4, 110.88, 106.09, 106.84, 287104900],
            [1600695000000, 104.54, 110.19, 103.1, 110.08, 195713800],
            [1600781400000, 112.68, 112.86, 109.16, 111.81, 183055400],
            [1600867800000, 111.62, 112.11, 106.77, 107.12, 150718700],
            [1600954200000, 105.17, 110.25, 105, 108.22, 167743300],
  
            [1602250200000, 115.28, 117, 114.92, 116.97, 100506900],
            [1602509400000, 120.06, 125.18, 119.28, 124.4, 240226800],
            [1602595800000, 125.27, 125.39, 119.65, 121.1, 262330500],
            [1602682200000, 121, 123.03, 119.62, 121.19, 150712000],
            [1602768600000, 118.72, 121.2, 118.15, 120.71, 112559200],
            [1602855000000, 121.28, 121.55, 118.81, 119.02, 115393800],
            [1603114200000, 119.96, 120.42, 115.66, 115.98, 120639300],
            [1603200600000, 116.2, 118.98, 115.63, 117.51, 124423700],
        
            [1603805400000, 115.49, 117.28, 114.54, 116.6, 92276800],
            [1603891800000, 115.05, 115.43, 111.1, 111.2, 143937800],
            [1603978200000, 112.37, 116.93, 112.2, 115.32, 146129200],
            [1604064600000, 111.06, 111.99, 107.72, 108.86, 190272600],
            [1604327400000, 109.11, 110.68, 107.32, 108.77, 122866900],
           
            [1605623400000, 119.55, 120.67, 118.96, 119.39, 74271000],
            [1605709800000, 118.61, 119.82, 118, 118.03, 76322100],
            [1605796200000, 117.59, 119.06, 116.81, 118.64, 74113000],
            [1605882600000, 118.64, 118.77, 117.29, 117.34, 73604300],
            [1606141800000, 117.18, 117.62, 113.75, 113.85, 127959300],
            [1606228200000, 113.91, 115.85, 112.59, 115.17, 113874200],
            [1606314600000, 115.55, 116.75, 115.17, 116.03, 76499200],
            [1606487400000, 116.57, 117.49, 116.22, 116.59, 46691300],
            [1606746600000, 116.97, 120.97, 116.81, 119.05, 169410200],
            [1606833000000, 121.01, 123.47, 120.01, 122.72, 127728200],
            [1606919400000, 122.02, 123.37, 120.89, 123.08, 89004200],
            [1607005800000, 123.52, 123.78, 122.21, 122.94, 78967600],
            [1607092200000, 122.6, 122.86, 121.52, 122.25, 78260400],
            [1607351400000, 122.31, 124.57, 122.25, 123.75, 86712000],
            [1607437800000, 124.37, 124.98, 123.09, 124.38, 82225500],
            [1607524200000, 124.53, 125.95, 121, 121.78, 115089200],
            [1607610600000, 120.5, 123.87, 120.15, 123.24, 81312200],
            [1607697000000, 122.43, 122.76, 120.55, 122.41, 86939800],
            [1607956200000, 122.6, 123.35, 121.54, 121.78, 79184500],
            [1608042600000, 124.34, 127.9, 124.13, 127.88, 157243700],
            [1608129000000, 127.41, 128.37, 126.56, 127.81, 98208600],
            [1608215400000, 128.9, 129.58, 128.04, 128.7, 94359800],
            [1608301800000, 128.96, 129.1, 126.12, 126.66, 192541500],
       
            [1609857000000, 128.89, 131.74, 128.43, 131.01, 97664900],
            [1609943400000, 127.72, 131.05, 126.38, 126.6, 155088000],
            [1610029800000, 128.36, 131.63, 127.86, 130.92, 109578200],
            [1610116200000, 132.43, 132.63, 130.23, 132.05, 105158200],
            [1610375400000, 129.19, 130.17, 128.5, 128.98, 100384500],
            [1610461800000, 128.5, 129.69, 126.86, 128.8, 91951100],
            [1610548200000, 128.76, 131.45, 128.49, 130.89, 88636800],
            [1610634600000, 130.8, 131, 128.76, 128.91, 90221800],
            [1610721000000, 128.78, 130.22, 127, 127.14, 111598500],
            [1611066600000, 127.78, 128.71, 126.94, 127.83, 90757300],
            [1611153000000, 128.66, 132.49, 128.55, 132.03, 104319500],
            [1611239400000, 133.8, 139.67, 133.59, 136.87, 120150900],
            [1611325800000, 136.28, 139.85, 135.02, 139.07, 114459400],
            [1611585000000, 143.07, 145.09, 136.54, 142.92, 157611700],

            [1613140200000, 134.35, 135.53, 133.69, 135.37, 60145100],
            [1613485800000, 135.49, 136.01, 132.79, 133.19, 80576300],
            [1613572200000, 131.25, 132.22, 129.47, 130.84, 97918500],
            [1613658600000, 129.2, 130, 127.41, 129.71, 96856700],
            [1613745000000, 130.24, 130.71, 128.8, 129.87, 87668800],
            [1614004200000, 128.01, 129.72, 125.6, 126, 103916400],
            [1614090600000, 123.76, 126.71, 118.39, 125.86, 158273000],
            [1614177000000, 124.94, 125.56, 122.23, 125.35, 111039900],
            [1614263400000, 124.68, 126.46, 120.54, 120.99, 148199500],
            [1614349800000, 122.59, 124.85, 121.2, 121.26, 164560400],
            [1614609000000, 123.75, 127.93, 122.79, 127.79, 116307900],
            [1614695400000, 128.41, 128.72, 125.01, 125.12, 102260900],
            [1614781800000, 124.81, 125.71, 121.84, 122.06, 112966300],
            [1614868200000, 121.75, 123.6, 118.62, 120.13, 178155000],
            [1614954600000, 120.98, 121.94, 117.57, 121.42, 153766600],
            [1615213800000, 120.93, 121, 116.21, 116.36, 154376600],
            [1615300200000, 119.03, 122.06, 118.79, 121.09, 129525800],
            [1615386600000, 121.69, 122.17, 119.45, 119.98, 111943300],
    
            [1616679000000, 119.54, 121.66, 119, 120.59, 98844700],
            [1616765400000, 120.35, 121.48, 118.92, 121.21, 94071200],
            [1617024600000, 121.65, 122.58, 120.73, 121.39, 80819200],
            [1617111000000, 120.11, 120.4, 118.86, 119.9, 85671900],
            [1617197400000, 121.65, 123.52, 121.15, 122.15, 118323800],
            [1617283800000, 123.66, 124.18, 122.49, 123, 75089100],
            [1617629400000, 123.87, 126.16, 123.07, 125.9, 88651200],
            [1617715800000, 126.5, 127.13, 125.65, 126.21, 80171300],
           
            [1618407000000, 134.94, 135, 131.66, 132.03, 87222800],
            [1618493400000, 133.82, 135, 133.64, 134.5, 89347100],
            [1618579800000, 134.3, 134.67, 133.28, 134.16, 84922400],
            [1618839000000, 133.51, 135.47, 133.34, 134.84, 94264200],
            [1618925400000, 135.02, 135.53, 131.81, 133.11, 94812300],
            [1619011800000, 132.36, 133.75, 131.3, 133.5, 68847100],
            [1619098200000, 133.04, 134.15, 131.41, 131.94, 84566500],
            [1619184600000, 132.16, 135.12, 132.16, 134.32, 78657500],
            [1619443800000, 134.83, 135.06, 133.56, 134.72, 66905100],
            [1619530200000, 135.01, 135.41, 134.11, 134.39, 66015800],
            [1619616600000, 134.31, 135.02, 133.08, 133.58, 107760100],
            [1619703000000, 136.47, 137.07, 132.45, 133.48, 151101000],
            [1619789400000, 131.78, 133.56, 131.07, 131.46, 109839500],
            [1620048600000, 132.04, 134.07, 131.83, 132.54, 75135100],
            [1620135000000, 131.19, 131.49, 126.7, 127.85, 137564700],
            [1620221400000, 129.2, 130.45, 127.97, 128.1, 84000900],
            [1620307800000, 127.89, 129.75, 127.13, 129.74, 78128300],
            [1620394200000, 130.85, 131.26, 129.48, 130.21, 78973300],
            [1620653400000, 129.41, 129.54, 126.81, 126.85, 88071200],

            [1621603800000, 127.82, 128, 125.21, 125.43, 79295400],
            [1621863000000, 126.01, 127.94, 125.94, 127.1, 63092900],
            [1621949400000, 127.82, 128.32, 126.32, 126.9, 72009500],
          ],
          
          responsive: true,
          color: "#7F98F3",
        },
      ],
    },
  };
  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);
  const [selectedOptions, setSelectedOptions] = useState<string[]>([]);

  const handleDropdownOpen = (event: any) => {
    setAnchorEl(event.currentTarget);
  };

  const handleDropdownClose = () => {
    setAnchorEl(null);
  };

  const handleOptionSelect = (event: React.ChangeEvent<HTMLInputElement>) => {
    const value = event.target.value;
    const isChecked = event.target.checked;

    if (isChecked) {
      setSelectedOptions((prevOptions) => [...prevOptions, value]);
    } else {
      setSelectedOptions((prevOptions) =>
        prevOptions.filter((option) => option !== value)
      );
    }
  };
  useEffect(() => {
    const source = axios.CancelToken.source();

    const getStatsData = async () => {
      setIsLoading(true);

      try {
        const response = await getODataWithParams(URLs.ipoOdata, {
          cancelToken: source.token,
        });

        if (response.status === 200 && response.data !== null) {
          setGraphData(response.data);
        }
      } catch (error) {
        if (axios.isCancel(error)) {
          console.log("Request cancelled:", (error as AxiosError).message);
        } else {
          console.error("An error occurred:", (error as AxiosError).message);
        }
      } finally {
        setIsLoading(false);
      }
    };

    getStatsData();

    return () => {
      source.cancel("Request cancelled due to component unmount");
    };
  }, []);
  return (
    <>
      <header className={styles.headerStyle}>
        <div className={styles.compnayLogoMainDiv}>
          <div>
            <Image
              src={"/icongoogle.svg"}
              alt="icongoogle"
              width={60}
              height={60}
            />
          </div>
          <div>microsoft [msft]</div>
        </div>
        <div>
          <div className={styles.rightStatusStyle}>
            IPO Status: &nbsp; <span style={{ fontWeight: 400 }}>Rumed</span>
          </div>
        </div>
      </header>
      <div className={styles.sectionsummarycontainer}>
        <div className={styles.textStyle}>
          $230.88{" "}
          <span className={styles.textStyle} style={{ color: "red" }}>
            (-2.33%)
          </span>
        </div>
        <div className={styles.textStyle}>
          at CLOSE: JUNE 8, 2023 3:58PM EST · NASDAQ
        </div>
        <div className={styles.chartContainerStyle}>
          <div style={{ width: "100%" }}>
            <DynamicChart options={options} />
          </div>
          <div className={styles.chartBottomSide}>
            <div className={styles.titleText}>
              <div>Announced</div>
              <div className={styles.completedMergers}>deal status</div>
            </div>
            <div className={styles.indicator} />

            <div className={styles.titleText}>
              <div>JAN 18, 2022</div>
              <div className={styles.completedMergers}>announced date</div>
            </div>
            <div className={styles.indicator} />
            <div className={styles.titleText}>
              <div>Acquisition: Public-Public</div>
              <div className={styles.completedMergers}>deal type</div>
            </div>
            <div className={styles.indicator} />
            <div className={styles.titleText}>
              <div style={{ color: "#38C546" }}>32.65%</div>
              <div className={styles.completedMergers}>target 1-YEAR CHG%</div>
            </div>
            <div className={styles.titleText}>
              <div style={{ color: "#EC0F0F" }}>-5.22%</div>
              <div className={styles.completedMergers}>target YTD CHG%</div>
            </div>
          </div>
        </div>
      </div>
    </>
  );
};

export default IposCompany;
